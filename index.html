<!DOCTYPE html>

<html>
	<head>
		<title>Karaoke Score - Record your singing and get a score</title>
		<link rel="stylesheet" href="style.css">

		<!-- OH NO EXTERNAL LINKS!!! RUNNNNNNNN!!! -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Chewy&family=Noto+Sans+JP:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	</head>
	<body
		style="
			font-family: 'Noto Sans', sans-serif;

			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			
			box-sizing: border-box;

			width: 100dvw;
			height: 100dvh;
			max-width: 100dvw;
			max-height: 100dvh;
			min-width: 100dvw;
			min-height: 100dvh;

			margin: 0;

			overflow: hidden;
		"
	>	
		<input type="checkbox" id="is-done-loading" autocomplete="off" style="display: none;">
		<div
			id="loading-cover"
			style="
				font-size: min(6svw, 2.5svh);

				position: absolute;
				display: flex;
				align-items: center;
				justify-content: center;

				background-color: #111;
				color: #eee;

				width: 100lvw;
				height: 100lvh;
				z-index: 1000;
			"
		>
			<div
				id="loading-circle"
				style="
					font-size: 1.8em;

					position: absolute;
					display: flex;
					flex-direction: column;
					align-items: center;
					justify-content: center;

					border-style: solid;
					border-width: 0.1em;
					border-radius: 50%;

					outline-style: solid;
					outline-offset: min(4svw, 4svh);
					outline-width: 0;
					outline-color: rgba(255, 255, 255, 0);

					width: min(40svw, 40svh);
					height: min(40svw, 40svh);

					transition: all 1s cubic-bezier(0, 0.5, 0.5, 1);
				"
			>
				<div style="font-weight: 700; margin-bottom: 0.5em;">Loading...</div>
				<div id="loading-percent" style="font-size: 0.75em">0%</div>
			</div>
		</div>

		<input id="is-fullscreen" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="is-settings-open" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="is-settings-closed" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="show-background" type="checkbox" autocomplete="off" style="display: var(--controls-display)" checked>
		<input id="showing-score" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="show-score" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect1" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect2" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect3" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect4" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect5" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect6" type="checkbox" autocomplete="off" style="display: var(--controls-display)">
		<input id="effect39" type="checkbox" autocomplete="off" style="display: var(--controls-display)">

		<div id="background"></div>
		<div id="gif-container"><div id="gif"></div></div>
		<div id="flash"></div>

		<div id="score-container">
			<div id="spinner"></div>
			<div id="banner"></div>
			<div id="score">39</div>
			<div class="bloom" id="bloom0"></div>
		</div>

		<div id="message">OO EE OO</div>

		<div id="start-button-container" class="button-container" onclick="startKaraoke()">
			<div id="start-button" class="button">Start Recording</div>
		</div>

		<div id="finish-button-container" class="button-container" onclick="finishKaraoke()" style="display: none">
			<div id="finish-button" class="button">Stop Recording</div>
		</div>

		<div id="visualizer"></div>

		<div id="fullscreen-button" onclick="toggleFullscreen()" class="extra-button">
			<div class="icon-flipper">
				<div id="fullscreen-icon" class="icon"></div>
			</div>
			<div id="fullscreen-text">Enter Fullscreen</div>
		</div>

		<div id="settings-button" onclick="openSettings()" class="extra-button">
			<div class="icon-flipper">
				<div id="settings-icon" class="icon">
					<div></div>
					<div></div>
					<div></div>
					<div></div>
				</div>
			</div>
		</div>

		<div id="settings-container"><div id="settings">

			<div class="settings-title">Settings</div>

			<table>
				<tbody>
					<tr>
						<td><div>
							<label for="volume-input">Volume</label>
						</div></td>
						<td><div>
							<input 
								type="range"
								id="volume-slider"
								min="0"
								step="10"
								max="100"
								oninput="document.getElementById('volume-input').value = setVolume(this.value)"
							>
							<input 
								type="text"
								id="volume-input" 
								size="3"
								oninput="this.value = this.value.replace(/[^0-9\.]/g, '').replace(/(\..*)\./g, '$1')"
								onchange="document.getElementById('volume-slider').value = setVolume(this.value); this.value = volume"
							>
						</div></td>
					</tr>
					<tr>
						<td><div>
							<label for="calculation-input">Score Calculation</label>
						</div></td>
						<td><div>
							<input
								type="button"
								id="calculation-input"
								class="button3"
								onclick="this.value = cycleCalculation()"
							>
						</div></td>
					</tr>
					<tr>
						<td><div>
							<label for="randomization-input">Final Score Randomization</label>
						</div></td>
						<td><div>
							<input
								type="button"
								id="randomization-input"
								class="button3"
								onclick="this.value = cycleRandomization()"
								value="test"
							>
						</div></td>
					</tr>
				</tbody>
			</table>

			<input type="button" id="test-microphone-button" value="Test Microphone" onclick="toggleLoopback(this)">

			<input type="button" id="settings-reset-button" value="Reset to Default" onclick="resetSettings()">
			<input type="button" id="settings-ok-button" value="OK" class="button1" onclick="closeSettings()">

		</div></div>

		<div class="bloom-container" style="top: 25%; left: 25%"><div class="bloom" id="bloom1"></div></div>
		<div class="bloom-container" style="top: 60%; left: 80%"><div class="bloom" id="bloom2"></div></div>
		<div class="bloom-container" style="top: 70%; left: 10%"><div class="bloom" id="bloom3"></div></div>
		<div class="bloom-container" style="top: 15%; left: 70%"><div class="bloom" id="bloom4"></div></div>

		<script>
			const totalScripts = 9
			var loadedScripts = 0

			function onScriptLoad() {
				loadedScripts++

				const progress = loadedScripts/totalScripts
				const percent = Math.floor(progress * 100)

				document.getElementById("loading-percent").innerText = percent + '%'
				document.getElementById("loading-circle").style.outlineOffset = `min(${4 - 4 * progress}svw, ${4 - 4 * progress}svh)`
				document.getElementById("loading-circle").style.outlineWidth = `min(${5 * progress}svw, ${5 * progress}svh)`
				document.getElementById("loading-circle").style.outlineColor = `rgba(255, 255, 255, ${progress})`

				if (loadedScripts >= totalScripts) {
					document.getElementById('is-done-loading').checked = true
				} 
			}
		</script>

		<script src="scripts/stream.js"></script>
		<script src="scripts/analysis.js"></script>
		<script src="scripts/melody.js"></script>
		<script src="scripts/key.js"></script>
		<script src="scripts/key-probabilities.js"></script>
		<script src="scripts/score.js"></script>
		<script src="scripts/display.js"></script>
		<script src="scripts/settings.js"></script>
		<script src="scripts/sensitivity.js"></script>
	</body>
</html>